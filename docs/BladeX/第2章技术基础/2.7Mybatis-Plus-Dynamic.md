# åŸºç¡€å¿…è¯»

dynamic-datasource-spring-boot-starter ğŸ”¥æ˜¯ä¸€ä¸ªåŸºäºspringbootçš„å¿«é€Ÿé›†æˆå¤šæ•°æ®æºçš„å¯åŠ¨å™¨ã€‚

å…¶æ”¯æŒ**Jdk 1.7+, SpringBoot 1.5.x å’Œ 2.x.x**ã€‚

## ç‰¹æ€§

1.  æ”¯æŒ**æ•°æ®æºåˆ†ç»„**ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯ çº¯ç²¹å¤šåº“ è¯»å†™åˆ†ç¦» ä¸€ä¸»å¤šä» æ··åˆæ¨¡å¼ã€‚
2.  æ”¯æŒæ•°æ®åº“æ•æ„Ÿé…ç½®ä¿¡æ¯**åŠ å¯†**ENC()ã€‚
3.  æ”¯æŒæ¯ä¸ªæ•°æ®åº“ç‹¬ç«‹åˆå§‹åŒ–è¡¨ç»“æ„schemaå’Œæ•°æ®åº“databaseã€‚
4.  æ”¯æŒ**è‡ªå®šä¹‰æ³¨è§£**ï¼Œéœ€ç»§æ‰¿DS(3.2.0+)ã€‚
5.  æä¾›å¯¹Druidï¼ŒMybatis-Plusï¼ŒP6syï¼ŒJndiçš„å¿«é€Ÿé›†æˆã€‚
6.  ç®€åŒ–Druidå’ŒHikariCpé…ç½®ï¼Œæä¾›**å…¨å±€å‚æ•°é…ç½®**ã€‚é…ç½®ä¸€æ¬¡ï¼Œå…¨å±€é€šç”¨ã€‚
7.  æä¾›**è‡ªå®šä¹‰æ•°æ®æºæ¥æº**æ–¹æ¡ˆã€‚
8.  æä¾›é¡¹ç›®å¯åŠ¨å**åŠ¨æ€å¢åŠ ç§»é™¤æ•°æ®æº**æ–¹æ¡ˆã€‚
9.  æä¾›Mybatisç¯å¢ƒä¸‹çš„**çº¯è¯»å†™åˆ†ç¦»**æ–¹æ¡ˆã€‚
10.  æä¾›ä½¿ç”¨**spelåŠ¨æ€å‚æ•°**è§£ææ•°æ®æºæ–¹æ¡ˆã€‚å†…ç½®spelï¼Œsessionï¼Œheaderï¼Œæ”¯æŒè‡ªå®šä¹‰ã€‚
11.  æ”¯æŒ**å¤šå±‚æ•°æ®æºåµŒå¥—åˆ‡æ¢**ã€‚ï¼ˆServiceA >>> ServiceB >>> ServiceCï¼‰ã€‚
12.  æä¾›å¯¹shiroï¼Œsharding-jdbc,quartzç­‰ç¬¬ä¸‰æ–¹åº“é›†æˆçš„æ–¹æ¡ˆ,æ³¨æ„äº‹é¡¹å’Œç¤ºä¾‹ã€‚
13.  æä¾›**åŸºäºseataçš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆã€‚**é™„ï¼šä¸æ”¯æŒåŸç”Ÿspringäº‹åŠ¡ã€‚
14.  æä¾›**æœ¬åœ°å¤šæ•°æ®æºäº‹åŠ¡æ–¹æ¡ˆã€‚**é™„ï¼šä¸æ”¯æŒåŸç”Ÿspringäº‹åŠ¡ã€‚

## çº¦å®š

1.  æœ¬æ¡†æ¶åªåš**åˆ‡æ¢æ•°æ®æº**è¿™ä»¶æ ¸å¿ƒçš„äº‹æƒ…ã€‚
2.  é…ç½®æ–‡ä»¶æ‰€æœ‰ä»¥ä¸‹åˆ’çº¿`_`åˆ†å‰²çš„æ•°æ®æº**é¦–éƒ¨**å³ä¸ºç»„çš„åç§°ï¼Œç›¸åŒç»„åç§°çš„æ•°æ®æºä¼šæ”¾åœ¨ä¸€ä¸ªç»„ä¸‹ã€‚
3.  åˆ‡æ¢æ•°æ®æºå¯ä»¥æ˜¯ç»„åï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“æ•°æ®æºåç§°ã€‚ç»„ååˆ™åˆ‡æ¢æ—¶é‡‡ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•åˆ‡æ¢ã€‚
4.  é»˜è®¤çš„æ•°æ®æºåç§°ä¸º**master**ï¼Œä½ å¯ä»¥é€šè¿‡`spring.datasource.dynamic.primary`ä¿®æ”¹ã€‚
5.  æ–¹æ³•ä¸Šçš„æ³¨è§£ä¼˜å…ˆäºç±»ä¸Šæ³¨è§£ã€‚

## ä½¿ç”¨æ–¹æ³•

1.  å¼•å…¥dynamic-datasource-spring-boot-starterã€‚[![](https://img.shields.io/maven-central/v/com.baomidou/dynamic-datasource-spring-boot-starter.svg)](http://mvnrepository.com/artifact/com.baomidou/dynamic-datasource-spring-boot-starter)

~~~xml
<dependency>
  <groupId>com.baomidou</groupId>
  <artifactId>dynamic-datasource-spring-boot-starter</artifactId>
  <version>${version}</version>
</dependency>

~~~

2.  é…ç½®æ•°æ®æºã€‚

~~~yaml
spring:
  datasource:
    dynamic:
      primary: master #è®¾ç½®é»˜è®¤çš„æ•°æ®æºæˆ–è€…æ•°æ®æºç»„,é»˜è®¤å€¼å³ä¸ºmaster
      strict: false #è®¾ç½®ä¸¥æ ¼æ¨¡å¼,é»˜è®¤falseä¸å¯åŠ¨. å¯åŠ¨ååœ¨æœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸,ä¸å¯åŠ¨åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®æº.
      datasource:
        master:
          url: jdbc:mysql://xx.xx.xx.xx:3306/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver # 3.2.0å¼€å§‹æ”¯æŒSPIå¯çœç•¥æ­¤é…ç½®
        slave_1:
          url: jdbc:mysql://xx.xx.xx.xx:3307/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver
        slave_2:
          url: ENC(xxxxx) # å†…ç½®åŠ å¯†,ä½¿ç”¨è¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
          username: ENC(xxxxx)
          password: ENC(xxxxx)
          driver-class-name: com.mysql.jdbc.Driver
          schema: db/schema.sql # é…ç½®åˆ™ç”Ÿæ•ˆ,è‡ªåŠ¨åˆå§‹åŒ–è¡¨ç»“æ„
          data: db/data.sql # é…ç½®åˆ™ç”Ÿæ•ˆ,è‡ªåŠ¨åˆå§‹åŒ–æ•°æ®
          continue-on-error: true # é»˜è®¤true,åˆå§‹åŒ–å¤±è´¥æ˜¯å¦ç»§ç»­
          separator: ";" # sqlé»˜è®¤åˆ†å·åˆ†éš”ç¬¦
          
       #......çœç•¥
       #ä»¥ä¸Šä¼šé…ç½®ä¸€ä¸ªé»˜è®¤åº“masterï¼Œä¸€ä¸ªç»„slaveä¸‹æœ‰ä¸¤ä¸ªå­åº“slave_1,slave_2

~~~

~~~
# å¤šä¸»å¤šä»                      çº¯ç²¹å¤šåº“ï¼ˆè®°å¾—è®¾ç½®primaryï¼‰                   æ··åˆé…ç½®
spring:                               spring:                               spring:
  datasource:                           datasource:                           datasource:
    dynamic:                              dynamic:                              dynamic:
      datasource:                           datasource:                           datasource:
        master_1:                             mysql:                                master:
        master_2:                             oracle:                               slave_1:
        slave_1:                              sqlserver:                            slave_2:
        slave_2:                              postgresql:                           oracle_1:
        slave_3:                              h2:                                   oracle_2:

~~~

3.  ä½¿ç”¨**@DS**åˆ‡æ¢æ•°æ®æºã€‚

**@DS**å¯ä»¥æ³¨è§£åœ¨æ–¹æ³•ä¸Šæˆ–ç±»ä¸Šï¼Œ**åŒæ—¶å­˜åœ¨å°±è¿‘åŸåˆ™ æ–¹æ³•ä¸Šæ³¨è§£ ä¼˜å…ˆäº ç±»ä¸Šæ³¨è§£**ã€‚

| æ³¨è§£ | ç»“æœ |
| --- | --- |
| æ²¡æœ‰@DS | é»˜è®¤æ•°æ®æº |
| @DS("dsName") | dsNameå¯ä»¥ä¸ºç»„åä¹Ÿå¯ä»¥ä¸ºå…·ä½“æŸä¸ªåº“çš„åç§° |

~~~java
@Service
@DS("slave")
public class UserServiceImpl implements UserService {

  @Autowired
  private JdbcTemplate jdbcTemplate;

  public List selectAll() {
    return  jdbcTemplate.queryForList("select * from user");
  }
  
  @Override
  @DS("slave_1")
  public List selectByCondition() {
    return  jdbcTemplate.queryForList("select * from user where age >10");
  }
}
~~~


## å®˜æ–¹æ–‡æ¡£
æ–‡æ¡£ç›´è¾¾ï¼šhttps://www.kancloud.cn/tracy5546/dynamic-datasource
